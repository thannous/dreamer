appId: com.tanuki75.dreamapp
---
# Guest dream limit with signup - third dream saved to account on signup
- launchApp

# Guest dream 1 - save successfully as guest
- tapOn:
    id: input.dreamTranscript
- inputText: "Guest Limit Dream 1"
- tapOn:
    id: btn.saveDream
- waitForAnimationToEnd
# Dismiss first-dream sheet
- tapOn: "Not now|Pas maintenant|Ahora no"

# Guest dream 2 - save successfully as guest and use analyze prompt to reach detail
- tapOn:
    id: input.dreamTranscript
- inputText: "Guest Limit Dream 2"
- tapOn:
    id: btn.saveDream
- waitForAnimationToEnd
# Analyze-prompt bottom sheet should be visible for non-first dreams
- assertVisible: "Analyze this dream?|Analyser ce rêve ?|¿Analizar este sueño?"
- tapOn: "Analyze now|Analyser maintenant|Analizar ahora"
- waitForAnimationToEnd
# Verify we reached the dream detail screen
- assertVisible:
    id: btn.exploreDream

# Return to the home screen, then back to recording for the third dream
- tapOn: "Accueil|Home"
- tapOn:
    id: btn.addDream

# Guest dream 3 - should be blocked by guest limit bottom sheet
- tapOn:
    id: input.dreamTranscript
- inputText: "Guest Limit Dream 3"
- tapOn:
    id: btn.saveDream

# Verify guest limit bottom sheet (multi-language)
- assertVisible: "Limit reached|Limite atteinte|Límite alcanzado"

# Tap CTA to go to account / settings
- tapOn: "Go to account|Ouvrir mon compte|Ir a mi cuenta"

# Create account via email/password
- tapOn:
    id: input.auth.email
- inputText: "guest.limit+signup@dreamer.test"
- tapOn:
    id: input.auth.password
- inputText: "guestpass"
- tapOn:
    id: btn.auth.signUp

# Dismiss signup success alert and verify banner is shown
- tapOn: "OK|D'accord|Aceptar"
- assertVisible:
    id: component.emailVerificationBanner

# Simulate verifying the email via resend CTA
- tapOn:
    id: btn.auth.resendVerification
- waitForAnimationToEnd
- assertNotVisible:
    id: component.emailVerificationBanner

# Verify we are signed in (email visible)
- assertVisible:
    id: text.auth.email

# Navigate to journal tab
- tapOn: "Journal"
- waitForAnimationToEnd
- assertVisible:
    id: screen.journal

# Verify the three dreams exist in the journal list
- assertVisible: "Guest Limit Dream 1"
- assertVisible: "Guest Limit Dream 2"
- assertVisible: "Guest Limit Dream 3"
